<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìº˜ë¦¬ê·¸ë¼í”¼ í•©ì„±ê¸° - ë°°ê²½ ì´ë¯¸ì§€ ì—…ë¡œë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Jua', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="calligraphy-common.css">
</head>
<body>
    <!-- í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ ë° ë©”ë‰´ -->
    <div id="menu-hamburger" style="position:fixed;top:24px;right:28px;z-index:9999;cursor:pointer;width:44px;height:44px;display:flex;align-items:center;justify-content:center;background:transparent;border-radius:50%;transition:background 0.18s;">
        <div style="display:flex;flex-direction:column;gap:4px;">
            <span class="menu-bar" style="display:block;height:4px;width:100%;background:#fff;border-radius:2px;"></span>
            <span class="menu-bar" style="display:block;height:4px;width:100%;background:#fff;border-radius:2px;"></span>
            <span class="menu-bar" style="display:block;height:4px;width:100%;background:#fff;border-radius:2px;"></span>
        </div>
    </div>
    <div id="menu-popup" style="display:none;position:fixed;top:70px;right:32px;z-index:10000;background:#fff;border-radius:16px;box-shadow:0 4px 24px #0003;padding:18px 28px 14px 28px;min-width:180px;text-align:left;">
    </div>

    <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
    <button class="back-button" onclick="goBack()" style="display: none;">â†</button>

    <!-- ë‹¨ê³„ 1: ë°°ê²½ ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
    <div class="step active" id="step1">
        <div class="container mx-auto px-4 py-4">
            <h1 class="text-3xl text-center text-white mb-8">ìº˜ë¦¬ê·¸ë¼í”¼ í•©ì„±ê¸°</h1>
            <div class="text-center mb-4">
                <span class="text-sm text-gray-300">v0.13</span>
            </div>
            
            <div class="max-w-2xl mx-auto">
                <div class="control-panel">
                    <h2 class="text-xl mb-4 text-center">1. ë°°ê²½ ì‚¬ì§„ ì—…ë¡œë“œ</h2>
                    <div class="file-upload-area" id="backgroundUploadArea" onclick="document.getElementById('backgroundInput').click()">
                        <div class="text-6xl mb-4">ğŸ–¼ï¸</div>
                        <p class="text-lg mb-2">ë°°ê²½ ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</p>
                        <p class="text-gray-600">í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ</p>
                        <input type="file" id="backgroundInput" accept="image/*" style="display: none;">
                    </div>
                    <div id="backgroundCheckArea" class="mt-4" style="display: none;">
                        <div class="text-center flex flex-col items-center justify-center">
                            <div class="check-icon mb-4 flex justify-center">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" fill="#10B981" stroke="#10B981" stroke-width="2"/>
                                    <path d="M8 12l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <p class="text-green-600 font-semibold text-center">ë°°ê²½ ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                        </div>
                    </div>
                </div>
                
            </div>
            
        </div>
    </div>

    <!-- ì»¤ìŠ¤í…€ ëª¨ë‹¬ -->
    <div class="custom-modal" id="customModal">
        <div class="custom-modal-content">
            <h3 id="modalTitle">ì•Œë¦¼</h3>
            <p id="modalMessage">ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            <div>
                <button id="modalConfirm" onclick="closeModal()">í™•ì¸</button>
                <button id="modalCancel" onclick="closeModal()" class="secondary" style="display: none;">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script src="calligraphy-common.js"></script>
    <script>
        // ë‹¨ê³„ 1 ì „ìš© JavaScript
        document.addEventListener('DOMContentLoaded', () => {
            const backgroundInput = document.getElementById('backgroundInput');
            const backgroundUploadArea = document.getElementById('backgroundUploadArea');
            
            // íŒŒì¼ ì…ë ¥ ì´ë²¤íŠ¸ - ì—…ë¡œë“œ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
            backgroundInput.addEventListener('change', async () => {
                console.log('íŒŒì¼ ì„ íƒë¨, ì—…ë¡œë“œ ì‹œì‘');
                
                // ì¦‰ì‹œ ë¡œë”© ìƒíƒœ í‘œì‹œ
                const backgroundUploadArea = document.getElementById('backgroundUploadArea');
                if (backgroundUploadArea) {
                    backgroundUploadArea.innerHTML = `
                        <div class="text-6xl mb-4">â³</div>
                        <p class="text-lg mb-2">ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘...</p>
                        <p class="text-gray-600">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
                    `;
                }
                
                try {
                    const result = await handleFileUpload(backgroundInput, 'background');
                    console.log('ì—…ë¡œë“œ ê²°ê³¼:', result);
                    
                    // ì—…ë¡œë“œ ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
                    if (result.success && backgroundImage) {
                        console.log('ì—…ë¡œë“œ ì™„ë£Œ, step2ë¡œ ìë™ ì´ë™');
                        await saveData();
                        // ì¦‰ì‹œ ì´ë™ (ì§€ì—° ì—†ìŒ)
                        window.location.href = 'calligraphy-step2.html';
                    } else {
                        console.log('ì—…ë¡œë“œ ì‹¤íŒ¨ - ë°ì´í„° ì—†ìŒ');
                        showModal('ì˜¤ë¥˜', 'ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        // ì‹¤íŒ¨ ì‹œ ì›ë˜ ìƒíƒœë¡œ ë³µì›
                        if (backgroundUploadArea) {
                            backgroundUploadArea.innerHTML = `
                                <div class="text-6xl mb-4">ğŸ–¼ï¸</div>
                                <p class="text-lg mb-2">ë°°ê²½ ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</p>
                                <p class="text-gray-600">í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ</p>
                            `;
                        }
                    }
                } catch (error) {
                    console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                    showModal('ì˜¤ë¥˜', `ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                    // ì‹¤íŒ¨ ì‹œ ì›ë˜ ìƒíƒœë¡œ ë³µì›
                    if (backgroundUploadArea) {
                        backgroundUploadArea.innerHTML = `
                            <div class="text-6xl mb-4">ğŸ–¼ï¸</div>
                            <p class="text-lg mb-2">ë°°ê²½ ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</p>
                            <p class="text-gray-600">í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ</p>
                        `;
                    }
                }
            });
            
            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
            setupDragAndDrop(backgroundUploadArea, backgroundInput);
            
            
            // ë°ì´í„° ë³µì›
            restoreData();
            
            // step1 í˜ì´ì§€ ê°•ì œ í™œì„±í™”
            const step1El = document.getElementById('step1');
            if (step1El) {
                step1El.classList.add('active');
            }
            
            // ë°°ê²½ ì´ë¯¸ì§€ê°€ ì´ë¯¸ ìˆë‹¤ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
            if (backgroundImage) {
                console.log('ì´ë¯¸ ì—…ë¡œë“œëœ ë°°ê²½ ì´ë¯¸ì§€ ìˆìŒ, step2ë¡œ ìë™ ì´ë™');
                // ì¦‰ì‹œ ì´ë™ (ì§€ì—° ì—†ìŒ)
                window.location.href = 'calligraphy-step2.html';
            }
        });
    </script>
</body>
</html>
